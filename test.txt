hello
djdj


view: sales_view {
  dimension: net_sales_value {
    type: number
    sql: ${TABLE}.net_sales_value ;;
  }
  
  dimension: trade_margin_per_kg {
    type: number
    sql: ${TABLE}.trade_margin_per_kg ;;
  }
  
  dimension: sales_margin_class {
    type: string
    sql: 
      CASE 
        WHEN ${net_sales_value} > 1500000 AND ${trade_margin_per_kg} > 2.09 THEN 'A'
        WHEN ${net_sales_value} BETWEEN 500000 AND 1500000 AND ${trade_margin_per_kg} BETWEEN 1.46 AND 2.09 THEN 'B'
        ELSE 'C'
      END ;;
  }
  
  measure: product_count {
    type: count
    drill_fields: [net_sales_value, trade_margin_per_kg]
  }
  
  measure: net_sales_percentage {
    type: number
    sql: ${net_sales_value} / sum(${net_sales_value}) OVER (PARTITION BY ${sales_margin_class}) * 100 ;;
    value_format_name: "percent_1"
  }
  
  dimension_group: date {
    type: time
    timeframes: [date, week, month, quarter, year]
    sql: ${TABLE}.date ;;
  }
}
