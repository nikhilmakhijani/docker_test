hello
djdj


view: product_sales {
  dimension: product {
    type: string
    sql: ${TABLE}.product ;;
  }
  
  dimension: net_sales_class {
    type: string
    sql: CASE
          WHEN ${net_sales_value} < 500000 THEN 'Low'
          WHEN ${net_sales_value} >= 500000 AND ${net_sales_value} < 1500000 THEN 'Mid'
          ELSE 'High'
         END ;;
  }

  measure: sales_value {
    type: sum
    sql: ${sales_value} ;;
  }

  measure: sales_volume {
    type: sum
    sql: ${sales_volume} ;;
  }

  measure: internal_sales_value {
    type: sum
    sql: ${internal_sales_value} ;;
  }

  measure: net_sales_value {
    type: sum
    sql: (${sales_value} - (${internal_sales_value}*${sales_volume})) ;;
  }

  measure: trade_margin_per_kg {
    type: number
    sql: (${sales_value}/${sales_volume}) - (${net_sales_value}/(${sales_volume}*1000)) ;;
    value_format_name: decimal_2
  }

  dimension: trade_margin_class {
    type: string
    sql: CASE
          WHEN ${trade_margin_per_kg} < 1.46 THEN 'Low'
          WHEN ${trade_margin_per_kg} >= 1.46 AND ${trade_margin_per_kg} < 2.09 THEN 'Mid'
          ELSE 'High'
         END ;;
  }
  
  measure: percent_of_net_sales {
    type: number
    sql: CASE
          WHEN SUM(${net_sales_value}) = 0 THEN NULL
          ELSE ${net_sales_value}/SUM(${net_sales_value}) * 100
         END ;;
    value_format_name: percent_2
  }
}
